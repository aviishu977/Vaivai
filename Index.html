<!DOCTYPE html><html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>პოლაროიდი</title>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />
  <style>
    :root {
      --color-bg: #f4f6f9;
      --color-primary: #6C9BCF;
      --color-primary-dark: #517da7;
      --color-accent: #FFC6AC;
      --color-error: #FF6B6B;
      --color-white: #ffffff;
      --color-text: #1e1e1e;
      --color-muted: #777777;
      --font-main: 'Segoe UI', sans-serif;
      --radius: 12px;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      --spacing: 1rem;
      --max-width: 480px;
      --btn-height: 42px;
      --btn-font-size: 0.95rem;
    }
      @font-face {
  font-family: 'CustomFont'; /* თქვენი ფონტის სახელი */
  src: url('alk-sanet.ttf') }
    * { box-sizing: border-box; font-family: 'CustomFont';
    line-height: 1.3;}
body {
  margin: 0;
  font-family: var(--font-main);
  background: var(--color-bg);
  color: var(--color-text);
  max-width: var(--max-width);
  margin: auto;
}

header {
  background: var(--color-primary);
  color: var(--color-white);
  padding: var(--spacing);
  font-size: 1.2rem;
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
}

.material-symbols-rounded {
  font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 48;
  vertical-align: middle;
}

main { padding: var(--spacing); }

input, button, textarea {
  width: 100%;
  padding: 10px 14px;
  margin-bottom: 10px;
  font-size: 1rem;
  border-radius: var(--radius);
  border: 1px solid #ccc;
}

button {
  background: var(--color-primary);
  color: var(--color-white);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: var(--btn-font-size);
  height: var(--btn-height);
  padding: 0 1rem;
  line-height: 1;
}

button:hover { background: var(--color-primary-dark); }
#switchCameraBtn { background: var(--color-accent); color: black; }
#logout { background: var(--color-error); width: auto; padding: 0 0.8rem; }
.hidden { display: none !important; }
video, img { width: 100%; border-radius: var(--radius); margin-bottom: 10px; }
video.mirror { transform: scaleX(-1); }

#photoFeed .card {
  background: var(--color-white);
  padding: 10px;
  border-radius: var(--radius);
  margin-bottom: 10px;
  box-shadow: var(--shadow);
}
.meta { font-size: 0.8rem; color: var(--color-muted); }

.action-row {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
  margin-bottom: 1rem;
}
#openCamera { flex: 1; }

  </style>
</head>
<body>
  <header>
    <span class="material-symbols-rounded">photo_camera</span>
    <strong>პოლაროიდი</strong>
        <span class="material-symbols-rounded">photo_camera</span>
    
  </header>
  <main>
    <div id="authSection">
      <input id="email" placeholder="ელ. ფოსტა" />
      <input id="password" type="password" placeholder="პაროლი" />
      <button id="register"><span class="material-symbols-rounded">person_add</span> რეგისტრაცია</button>
      <button id="login"><span class="material-symbols-rounded">login</span> შესვლა</button>
    </div><div class="action-row hidden" id="userActions">
  <button id="openCamera">
    <span class="material-symbols-rounded">photo_camera_front</span> გადაღება
  </button>  <button id="logout"><span class="material-symbols-rounded">logout</span></button>
</div>

<div id="cameraSection" class="hidden">
  <button id="switchCameraBtn">
    <span class="material-symbols-rounded">switch_camera</span> კამერის გადართვა
  </button>
  <video id="video" autoplay playsinline></video>
  <textarea id="photoText" placeholder="ტექსტი ფოტოსთვის (სურვილისამებრ)"></textarea>
  <button id="snap">
    <span class="material-symbols-rounded">upload</span> ატვირთე
  </button>
</div>

<div id="photoFeed"></div>

  </main>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, setDoc, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRtcHMJJj-WD86E41ZVS3cm2ggQHyPYnI",
      authDomain: "photog-457a1.firebaseapp.com",
      projectId: "photog-457a1",
      storageBucket: "photog-457a1.appspot.com",
      messagingSenderId: "568507243860",
      appId: "1:568507243860:web:f9a7128c3e703aa79c3cc1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const register = document.getElementById("register");
    const login = document.getElementById("login");
    const logout = document.getElementById("logout");
    const openCamera = document.getElementById("openCamera");
    const snap = document.getElementById("snap");
    const switchBtn = document.getElementById("switchCameraBtn");
    const video = document.getElementById("video");
    const photoText = document.getElementById("photoText");
    const photoFeed = document.getElementById("photoFeed");
    const cameraSection = document.getElementById("cameraSection");
    const userActions = document.getElementById("userActions");

    let stream;
    let currentFacingMode = "user";

    async function startCamera() {
      if (stream) stream.getTracks().forEach(track => track.stop());
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentFacingMode }
        });
        video.srcObject = stream;
        cameraSection.classList.remove("hidden");
        video.classList.toggle("mirror", currentFacingMode === "user");
      } catch (err) {
        alert("კამერის ჩართვა ვერ მოხერხდა: " + err.message);
      }
    }

    switchBtn.onclick = () => {
      currentFacingMode = currentFacingMode === "user" ? "environment" : "user";
      startCamera();
    };

    snap.onclick = async () => {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      if (currentFacingMode === "user") {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(video, 0, 0);
      const imgData = canvas.toDataURL("image/jpeg", 0.8);
      const user = auth.currentUser;
      if (!user) return;
      await setDoc(doc(db, "photos", user.uid), {
        uid: user.uid,
        email: user.email,
        photo: imgData,
        text: photoText.value || "",
        timestamp: new Date()
      });
      cameraSection.classList.add("hidden");
      stream.getTracks().forEach(track => track.stop());
      photoText.value = "";
    };

    register.onclick = () => createUserWithEmailAndPassword(auth, email.value, password.value).catch(e => alert(e.message));
    login.onclick = () => signInWithEmailAndPassword(auth, email.value, password.value).catch(e => alert(e.message));
    logout.onclick = () => signOut(auth);
    openCamera.onclick = () => startCamera();

    function renderFeed() {
      const q = query(collection(db, "photos"), orderBy("timestamp", "desc"));
      onSnapshot(q, snapshot => {
        photoFeed.innerHTML = "";
        snapshot.forEach(doc => {
          const d = doc.data();
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <img src="${d.photo}" alt="photo" />
            ${d.text ? `<p>${d.text}</p>` : ""}
            <div class="meta">${d.email} | ${new Date(d.timestamp.toDate()).toLocaleString()}</div>
          `;
          photoFeed.appendChild(div);
        });
      });
    }

    onAuthStateChanged(auth, (user) => {
      const loggedIn = !!user;
      email.style.display = password.style.display = register.style.display = login.style.display = loggedIn ? "none" : "block";
      userActions.classList.toggle("hidden", !loggedIn);
      if (loggedIn) renderFeed();
      else {
        cameraSection.classList.add("hidden");
        photoFeed.innerHTML = "";
        if (stream) stream.getTracks().forEach(t => t.stop());
      }
    });
  </script></body>
  </html>
